---
import MainLayout from '@/layouts/MainLayout.astro';
import { actions } from 'astro:actions';
import ProductList from '@/components/products/ProductList.svelte'
import Pagination from '@/components/shared/Pagination.astro';

const searchParams = Astro.url.searchParams
const pageParam = +(searchParams.get('page') ?? 1)

const { data, error } = await actions.getProductsByPage({
  page: pageParam
})

if(error) {
  return Astro.redirect('/')
}

const {products, totalPages} = data

if(data.products.length === 0) {
  return Astro.redirect(`/?page=${totalPages}`)
}

---

<MainLayout>
  <h1 class="text-3xl">Listado de Productos</h1>

  <ProductList products={products} client:load />

  <Pagination {totalPages} />

</MainLayout>
